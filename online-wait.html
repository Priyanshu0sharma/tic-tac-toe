<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Waiting Room - Tic Tac Toe</title>
<link rel="stylesheet" href="game.css" />
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body class="dark-theme">
<header>
  <h1>Waiting Room</h1>
</header>

<main>
  <div class="box">
    <p>Your Room ID:</p>
    <h2 id="roomIdDisplay">...</h2>
    <p id="waitingInfo">Waiting for other player...</p>
  </div>
</main>

<script src="../firebase-config.js"></script>
<script>
const roomIdDisplay = document.getElementById('roomIdDisplay');
const waitingInfo = document.getElementById('waitingInfo');

const roomId = sessionStorage.getItem('currentRoomId');
const mySymbol = sessionStorage.getItem('mySymbol');

if(!roomId || !mySymbol){
    waitingInfo.textContent = "Error: Room info missing!";
} else {
    const roomRef = firebase.database().ref('rooms/' + roomId);
    roomIdDisplay.textContent = roomId;

    roomRef.on('value', snap => {
        const data = snap.val();
        if(!data) return;

        // Both players joined
        if(data.creatorName && data.joinerName){
            waitingInfo.textContent = 'Both players joined. Starting game...';
            setTimeout(() => {
                window.location.href = 'online-game.html';
            }, 1000);
        } else {
            waitingInfo.textContent = 'Waiting for other player...';
        }
    });
}
</script>
</body>
</html>
